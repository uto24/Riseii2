
{% extends "base.html" %}

{% block content %}
<h1 class="text-3xl font-bold mb-6 text-gray-800">Admin Panel</h1>

<!-- Create Task Form -->
<div class="bg-white p-6 rounded-xl shadow-md mb-8 border border-gray-200">
    <div class="flex items-center mb-4 text-blue-600">
        <i class="fas fa-plus-circle text-2xl mr-2"></i>
        <h3 class="font-bold text-lg">Create New Task</h3>
    </div>
    
    <form method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Title -->
        <div class="col-span-2 md:col-span-1">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Task Title</label>
            <input type="text" name="title" placeholder="e.g. Subscribe my Channel" required class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Reward -->
        <div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Reward (BDT)</label>
            <input type="number" name="reward" placeholder="e.g. 2.50" step="0.01" required class="w-full border p-2 rounded focus:ring-2 focus:ring-green-500">
        </div>

        <!-- Category -->
        <div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Category</label>
            <select name="category" class="w-full border p-2 rounded bg-white">
                <option value="youtube">YouTube</option>
                <option value="facebook">Facebook</option>
                <option value="telegram">Telegram</option>
                <option value="website">Website Visit</option>
                <option value="other">Other</option>
            </select>
        </div>

        <!-- Proof Type -->
        <div>
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Proof Type</label>
            <select name="proof_requirement" class="w-full border p-2 rounded bg-white">
                <option value="image">Screenshot (Image)</option>
                <option value="link">Text / Link / Code</option>
            </select>
        </div>

        <!-- Task Link -->
        <div class="col-span-2">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Task Link (User will visit here)</label>
            <input type="url" name="task_link" placeholder="https://youtube.com/..." required class="w-full border p-2 rounded">
        </div>

        <!-- Description -->
        <div class="col-span-2">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Instructions / Steps</label>
            <textarea name="description" placeholder="Step 1: Go to link&#10;Step 2: Subscribe&#10;Step 3: Take Screenshot" rows="3" class="w-full border p-2 rounded"></textarea>
        </div>

        <button type="submit" name="create_task" class="col-span-2 bg-gray-900 text-white font-bold py-3 rounded hover:bg-black transition">
            Publish Task
        </button>
    </form>
</div>

<!-- ... (বাকি Admin Panel কোড - Withdraw/Approval Table একই থাকবে) ... -->
<!-- Pending Withdraws এবং Task Submissions এর টেবিলগুলো এখানে থাকবে -->
{% endblock %}
<!-- Pending Withdraws -->
<h3 class="font-bold text-lg mb-2">Pending Withdrawals</h3>
<div class="bg-white rounded shadow overflow-x-auto mb-8">
    <table class="w-full text-sm text-left">
        <thead class="bg-gray-100">
            <tr>
                <th class="p-3">User</th>
                <th class="p-3">Method</th>
                <th class="p-3">Amount</th>
                <th class="p-3">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for w in pending_withdraws %}
            <tr class="border-b">
                <td class="p-3">{{ w.email }}<br>{{ w.number }}</td>
                <td class="p-3 capitalize">{{ w.method }}</td>
                <td class="p-3 font-bold">৳{{ w.amount }}</td>
                <td class="p-3">
                    <!-- Check admin route variable context -->
                    {% set admin_path = request.path.strip('/').split('/')[0] %}
                    <a href="/{{ admin_path }}/approve_withdraw/{{ w.id }}" class="text-green-600 font-bold mr-2">Pay</a>
                    <a href="/{{ admin_path }}/reject_withdraw/{{ w.id }}" class="text-red-600">X</a>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="4" class="p-3 text-center text-gray-400">No pending withdrawals</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pending Tasks -->
<h3 class="font-bold text-lg mb-2">Task Submissions</h3>
<div class="grid gap-4">
    {% for sub in pending_tasks %}
    <div class="bg-white p-4 rounded shadow">
        <p class="text-xs text-gray-500">{{ sub.email }}</p>
        <p class="text-sm mt-1">
            <strong>Proof:</strong> 
            {% if sub.proof_type == 'image' %}
                <a href="{{ sub.proof }}" target="_blank" class="text-blue-500 underline">View Image</a>
            {% else %}
                {{ sub.proof }}
            {% endif %}
        </p>
        <div class="mt-3 flex gap-4">
            {% set admin_path = request.path.strip('/').split('/')[0] %}
            <a href="/{{ admin_path }}/approve_task/{{ sub.id }}" class="bg-green-500 text-white px-3 py-1 rounded text-xs">Approve</a>
            <a href="/{{ admin_path }}/reject_task/{{ sub.id }}" class="bg-red-500 text-white px-3 py-1 rounded text-xs">Reject</a>
        </div>
    </div>
    {% else %}
    <p class="text-center text-gray-500">No pending tasks.</p>
    {% endfor %}
</div>
{% endblock %}
