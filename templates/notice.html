{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto mt-4 mb-24 px-4 sm:px-6">
    
    <!-- হেডার -->
    <div class="relative overflow-hidden bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between mb-6">
        <div class="absolute -top-10 -right-10 w-32 h-32 bg-red-50 rounded-full blur-3xl opacity-50"></div>
        
        <div class="flex items-center gap-4 relative z-10">
            <div class="w-12 h-12 bg-gradient-to-tr from-red-500 to-rose-400 rounded-xl flex items-center justify-center text-white shadow-lg shadow-red-200">
                <i class="fas fa-bullhorn text-xl"></i>
            </div>
            <div>
                <h1 class="text-2xl font-extrabold text-gray-900 tracking-tight">নোটিশ বোর্ড</h1>
                <p class="text-sm text-gray-500 font-medium">প্রতিদিনের আপডেট</p>
            </div>
        </div>
        
        <a href="/dashboard" class="relative z-10 flex items-center gap-2 bg-gray-50 text-gray-700 px-4 py-2 rounded-xl text-sm font-semibold hover:bg-gray-100 transition-all border border-gray-200">
            <i class="fas fa-arrow-left"></i> ব্যাক
        </a>
    </div>

    <!-- ✅ ADMIN ONLY: POST NOTICE FORM -->
    {% if session.get('is_admin') %}
    <div class="bg-red-50 border border-red-100 p-5 rounded-2xl mb-8 shadow-sm">
        <h3 class="font-bold text-red-800 mb-3 flex items-center gap-2">
            <i class="fas fa-edit"></i> নতুন নোটিশ লিখুন
        </h3>
        <form method="POST" class="space-y-3">
            <input type="text" name="title" placeholder="নোটিশ টাইটেল..." required 
                   class="w-full border border-red-200 p-3 rounded-xl focus:ring-2 focus:ring-red-500 outline-none text-sm">
            
            <textarea name="message" rows="3" placeholder="বিস্তারিত লিখুন..." required
                      class="w-full border border-red-200 p-3 rounded-xl focus:ring-2 focus:ring-red-500 outline-none text-sm"></textarea>
            
            <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-lg font-bold text-sm hover:bg-red-700 transition shadow-lg w-full md:w-auto">
                পোস্ট করুন
            </button>
        </form>
    </div>
    {% endif %}

    <!-- নোটিশ লিস্ট -->
    <div class="grid gap-6">
        {% for notice in notices %}
        <article class="group bg-white rounded-2xl shadow-sm border border-gray-100 hover:border-red-200 transition-all duration-300 overflow-hidden relative">
            
            <!-- ✅ ADMIN ONLY: DELETE BUTTON -->
            {% if session.get('is_admin') %}
                {% set admin_path = request.path.strip('/').split('/')[0] %}
                <!-- Note: We assume admin route is 'admin' or handled via app config logic -->
                <!-- For safety, we use a generic delete route logic if available, otherwise manual link -->
                <a href="/{{ config.admin_route if config.admin_route else 'admin' }}/delete_notice/{{ notice.id }}" 
                   onclick="return confirm('এই নোটিশটি ডিলিট করবেন?')"
                   class="absolute top-3 right-3 z-20 bg-white text-red-500 p-2 rounded-full shadow-md hover:bg-red-50 transition border border-red-100" title="Delete">
                    <i class="fas fa-trash-alt"></i>
                </a>
            {% endif %}

            <div class="flex flex-col md:flex-row">
                <!-- Date Box -->
                <div class="md:w-28 bg-gray-50/50 border-b md:border-b-0 md:border-r border-gray-100 p-4 flex md:flex-col items-center justify-center text-center">
                    <span class="text-2xl font-black text-gray-800">{{ notice.date.strftime('%d') }}</span>
                    <span class="text-[10px] uppercase tracking-widest font-bold text-red-500 md:mt-1">{{ notice.date.strftime('%b') }}</span>
                    <span class="text-[10px] text-gray-400">{{ notice.date.strftime('%Y') }}</span>
                </div>

                <!-- Content -->
                <div class="flex-1 p-5">
                    <div class="mb-2 pr-8"> <!-- pr-8 prevents overlap with delete button -->
                        <h3 class="text-lg font-bold text-gray-800 group-hover:text-red-600 transition-colors">
                            {{ notice.title }}
                        </h3>
                        {% if loop.first %}
                        <span class="inline-flex items-center gap-1 bg-red-100 text-red-700 text-[10px] font-bold px-2 py-0.5 rounded mt-1 animate-pulse">
                            NEW
                        </span>
                        {% endif %}
                    </div>
                    
                    <!-- ✅ READ MORE LOGIC -->
                    <div class="text-gray-600 text-sm leading-relaxed whitespace-pre-line notice-content line-clamp-3" id="notice-{{ loop.index }}">
                        {{ notice.message }}
                    </div>
                    
                    <!-- Read More Button (JavaScript will show/hide this) -->
                    <button onclick="toggleReadMore('notice-{{ loop.index }}', this)" 
                            class="text-blue-600 text-xs font-bold mt-2 hover:underline hidden read-more-btn">
                        আরও পড়ুন...
                    </button>
                </div>
            </div>
        </article>
        {% else %}
        <div class="text-center py-16 bg-white rounded-2xl border-2 border-dashed border-gray-200">
            <div class="bg-gray-50 w-20 h-20 mx-auto rounded-full flex items-center justify-center mb-4">
                <i class="far fa-clipboard text-gray-400 text-3xl"></i>
            </div>
            <h3 class="text-gray-500 font-bold">কোনো নোটিশ নেই</h3>
        </div>
        {% endfor %}
    </div>

</div>

<!-- CSS for Line Clamping -->
<style>
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>

<!-- JS for Read More -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // সব নোটিশ চেক করা
        document.querySelectorAll('.notice-content').forEach((el, index) => {
            // যদি টেক্সট বেশি বড় হয়, বাটন দেখাবে
            if (el.scrollHeight > el.clientHeight) {
                el.nextElementSibling.classList.remove('hidden');
            }
        });
    });

    function toggleReadMore(id, btn) {
        const content = document.getElementById(id);
        
        if (content.classList.contains('line-clamp-3')) {
            content.classList.remove('line-clamp-3');
            btn.innerText = "গোপন করুন";
        } else {
            content.classList.add('line-clamp-3');
            btn.innerText = "আরও পড়ুন...";
        }
    }
</script>
{% endblock %}
